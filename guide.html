<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAML / OIDCガイド</title>
    <link rel="stylesheet" href="./assets/style.css" />
  </head>
  <body>
    <main>
      <h1>SAML / OIDCの詳細ガイドとこのデモの見どころ</h1>
      <p class="muted">
        このページでは、SAMLとOIDC（OpenID Connect）の基本から違いまでを整理しつつ、
        このデモで体験できるSAML-like / OIDC-likeフローの全体像をわかりやすく紹介します。
      </p>

      <div class="card-grid">
        <div class="card">
          <h2>🧩 SAMLとは</h2>
          <p>
            SAML（Security Assertion Markup Language）は、<strong>IdPが発行するアサーション</strong>をSPに渡し、
            ユーザーの認証結果や属性を伝えるための標準規格です。XMLベースで、企業間SSOで広く使われます。
          </p>
          <ul>
            <li><strong>主役のメッセージ</strong>: SAML Response / Assertion</li>
            <li><strong>得意な場面</strong>: 企業内システムやSaaSとのSSO連携</li>
            <li><strong>よく出てくる単語</strong>: AuthnRequest, ACS, 署名, 証明書</li>
          </ul>
        </div>
        <div class="card">
          <h2>🔐 OIDCとは</h2>
          <p>
            OIDC（OpenID Connect）は、OAuth 2.0を土台にした<strong>認証の拡張仕様</strong>です。
            認可コードを使ってID Tokenを取得し、ユーザーのログインを確認します。
          </p>
          <ul>
            <li><strong>主役のメッセージ</strong>: Authorization Code / ID Token / Access Token</li>
            <li><strong>得意な場面</strong>: モバイル/SPAなどモダンなアプリ連携</li>
            <li><strong>よく出てくる単語</strong>: /authorize, /token, scope, claims</li>
          </ul>
        </div>
        <div class="card">
          <h2>🔎 SAMLとOIDCの違い</h2>
          <ul>
            <li><strong>データ形式</strong>: SAMLはXML、OIDCはJSON + JWT</li>
            <li><strong>トークン取得</strong>: SAMLはレスポンス一括、OIDCはコード交換</li>
            <li><strong>適用領域</strong>: SAMLは企業向けSSO、OIDCはAPIやモバイルにも強い</li>
            <li><strong>設計思想</strong>: SAMLはフェデレーション、OIDCはOAuthを拡張</li>
          </ul>
          <p class="muted">
            どちらも「IdPが認証し、SPがログインを成立させる」という点は同じですが、
            メッセージの形式・交換方法・利用シーンに違いがあります。
          </p>
        </div>
      </div>

      <div class="card-grid">
        <div class="card">
          <h2>👥 登場人物（役割）</h2>
          <ul>
            <li><strong>IdP</strong>: ユーザー認証を行い、SAMLアサーションを発行</li>
            <li><strong>SP</strong>: 受け取ったアサーションを検証してログインを成立</li>
            <li><strong>ユーザー</strong>: SPにアクセスし、IdPで認証</li>
          </ul>
        </div>
        <div class="card">
          <h2>🧰 代表的な要素</h2>
          <ul>
            <li><span class="inline-code">AuthnRequest</span>: SPからIdPへの認証要求</li>
            <li><span class="inline-code">SAML Response</span>: IdPからSPへの応答</li>
            <li><span class="inline-code">Assertion</span>: 認証結果（ユーザー識別子や属性）</li>
            <li><span class="inline-code">ACS</span>: SP側で応答を受け取るエンドポイント</li>
          </ul>
        </div>
        <div class="card">
          <h2>🧭 フローの概要</h2>
          <ol>
            <li>SPがログイン開始（AuthnRequest送信）</li>
            <li>IdPでユーザー認証</li>
            <li>IdPがアサーションを生成しSAML Responseを送信</li>
            <li>SPのACSが検証しセッションを作成</li>
          </ol>
        </div>
      </div>

      <div class="card">
        <h2>🧵 シーケンス図で見る流れ</h2>
        <p class="muted">SAML-likeとOIDC-likeそれぞれの主要なメッセージのやり取りを簡略化して示しています。</p>
        <div class="card-grid">
          <div class="card">
            <h3>SAML-like シーケンス</h3>
            <div class="sequence-diagram">
              <div class="sequence-row">
                <span class="sequence-actor">SP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">IdP</span>
                <span class="sequence-detail">AuthnRequest を送信</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">IdP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">ユーザー</span>
                <span class="sequence-detail">認証・ユーザー選択</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">IdP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">SP</span>
                <span class="sequence-detail">SAML Response (Assertion)</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">SP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">SP</span>
                <span class="sequence-detail">検証・セッション作成</span>
              </div>
            </div>
          </div>
          <div class="card">
            <h3>OIDC-like シーケンス</h3>
            <div class="sequence-diagram">
              <div class="sequence-row">
                <span class="sequence-actor">SP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">IdP</span>
                <span class="sequence-detail">/authorize リクエスト</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">IdP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">ユーザー</span>
                <span class="sequence-detail">認証・同意</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">IdP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">SP</span>
                <span class="sequence-detail">認可コードを返却</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">SP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">IdP</span>
                <span class="sequence-detail">コード検証・Token交換</span>
              </div>
              <div class="sequence-row">
                <span class="sequence-actor">SP</span>
                <span class="sequence-arrow">→</span>
                <span class="sequence-actor">SP</span>
                <span class="sequence-detail">ID Token検証・セッション作成</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>✨ このデモでできること</h2>
        <div class="card-grid">
          <div class="card">
            <h3>設定の理解</h3>
            <p>
              Admin画面でSP Entity IDやACS URL、署名用の共有鍵などを編集し、
              IdPとSPの連携に必要な値がどこで使われるかを確認できます。
            </p>
          </div>
          <div class="card">
            <h3>SSO体験</h3>
            <p>
              SPからログインを開始し、IdPでユーザーを選択して認証する一連の流れを体験できます。
            </p>
          </div>
          <div class="card">
            <h3>アサーションの中身</h3>
            <p>
              生成されたSAML-likeレスポンスやアサーションを画面上で確認し、
              どんな情報がSPに渡るのかを観察できます。
            </p>
          </div>
          <div class="card">
            <h3>トークンの中身</h3>
            <p>
              OIDC-likeフローで受け取るID TokenやAccess Tokenの内容を確認し、
              claimsがどのように表現されるかを学べます。
            </p>
          </div>
          <div class="card">
            <h3>検証のポイント</h3>
            <p>
              SP側で署名や有効期限などの検証結果を確認し、
              正常系/異常系の振る舞いを学べます。
            </p>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>🚀 おすすめの進め方</h2>
        <ol>
          <li>SAML-likeデモ入口で初期化</li>
          <li>Adminでアプリ設定を確認</li>
          <li>SPでログイン開始</li>
          <li>IdPでユーザーを選択して認証</li>
          <li>SPのACS画面で検証結果とセッションを確認</li>
        </ol>
        <div class="stack">
          <a class="button" href="./saml.html">SAML-like デモ入口へ</a>
          <a class="button secondary" href="./oidc.html">OIDC-like デモ入口へ</a>
        </div>
      </div>

      <div class="notice">
        <strong>注意:</strong> 本デモは学習用にSAML/OIDCを簡略化した実装です。実際の運用では暗号署名や
        証明書、リプレイ攻撃対策、PKCEなどの詳細な検証が必要になります。
      </div>
    </main>
    <script type="module">
      import { renderHeader } from './shared/ui.js?v=1';

      renderHeader({ activeRole: 'guide', basePath: '.' });
    </script>
  </body>
</html>
